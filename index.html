<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Are We Stylo Yet?</title>
    <style type="text/css" media="screen">
      .metric-container {
        box-shadow: 0.5em 0.5em 0.5em grey;
        border: 1px solid grey;
        border-radius: 1em;
        margin: 1em;
        padding: 1em;
        text-align: center;
      }
      h1 {
        font-size: 5em;
        margin: 0px;
      }
      #cards{
        display: flex;
        flex-wrap: wrap;
      }
    </style>
  </head>
  <body>
    <h2>Are We Stylo Yet?</h2>
    <div id="cards">
    <div class="metric-container">
      <h2>Remaining Properties</h2>
      <p> Properties that are in Firefox but not in Stylo yet (<a href="https://manishearth.github.io/css-properties-list/">See what's missing</a>), should reach 100%</p>
      <h1 id="properties">Loading...</h3>
    </div>
    <div class="metric-container">
      <h2>Crashtest failures</h2>
      <p>Number of failures in crashtest, should reach 0%</p>
      <h1 id="crashtest_fails">Loading...</h3>
      <!--
      <p>Warning: The chart is still under development, the data may not be correct</p>
      <canvas id="crashtest_chart" width="200" height="100"></canvas>
      -->

    </div>
    <div class="metric-container">
      <h2>Reftest failures</h2>
      <p>Number of failures in reftest, should reach 0%</p>
      <h1 id="reftest_fails">Loading...</h3>
    </div>
    <div class="metric-container">
      <h2>Reftest disabled</h2>
      <p>Crashes, intermittents; should reach 0%</p>
      <h1 id="reftest_disabled">Loading...</h3>
    </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="css_properties_list.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">


      window.addEventListener('load', function(){
        // Download the data
        fetch('data.json')
        .then(function(response) {
          return response.json();
        })
        .then(function(jsondata) {
          var crashtest = document.getElementById('crashtest_fails');
          var percent = Math.round((jsondata['crashtest_fails'] / jsondata['crashtest_total']) * 100);
          crashtest.innerText = jsondata['crashtest_fails'] + "/" + jsondata['crashtest_total'] + " (" + percent + "%)";

          var reftest = document.getElementById('reftest_fails');
          percent = Math.round((jsondata['reftest_fails'] / (jsondata['reftest_passes']+ jsondata['reftest_fails'] + jsondata['reftest_disabled'])) * 100);
          reftest.innerText = jsondata['reftest_fails'] + "/" + (jsondata['reftest_passes']+ jsondata['reftest_fails'] + jsondata['reftest_disabled'])+ " (" + percent + "%)";

          var reftest = document.getElementById('reftest_disabled');
          percent = Math.round((jsondata['reftest_disabled'] / (jsondata['reftest_passes']+ jsondata['reftest_fails'] + jsondata['reftest_disabled'])) * 100);
          reftest.innerText = jsondata['reftest_disabled'] + "/" + (jsondata['reftest_passes']+ jsondata['reftest_fails'] + jsondata['reftest_disabled'])+ " (" + percent + "%)";
        });

        /*
        //Charts
        var mock_crashtest_data = [200, 180, 178, 168, 154, 143, 100]
        var mock_crashtest_date = ["12/23", "12/24", "12/25", "12/26", "12/27", "12/28", "12/29"]
        var data = {
          labels: mock_crashtest_date,
          datasets: [
            {
              label: "Crashtest Expected Failures",
              fill: false,
              lineTension: 0.1,
              backgroundColor: "rgba(75,192,192,0.4)",
              borderColor: "rgba(75,192,192,1)",
              borderCapStyle: 'butt',
              borderDash: [],
              borderDashOffset: 0.0,
              borderJoinStyle: 'miter',
              pointBorderColor: "rgba(75,192,192,1)",
              pointBackgroundColor: "#fff",
              pointBorderWidth: 1,
              pointHoverRadius: 5,
              pointHoverBackgroundColor: "rgba(75,192,192,1)",
              pointHoverBorderColor: "rgba(220,220,220,1)",
              pointHoverBorderWidth: 2,
              pointRadius: 1,
              pointHitRadius: 10,
              data: mock_crashtest_data,
              spanGaps: false,
            }
          ]
        };

        var ctx = document.getElementById("crashtest_chart");
        var myLineChart = new Chart(ctx, {
          type: 'line',
          data: data,
          //options: options
        });
        */

        // CSS properties
        var diff = new Set(FIREFOX);
        for (var elem of STYLO_ALL) {
          diff.delete(elem);
        }

        var remaining_properties_count = diff.size;
        var properties = document.getElementById('properties');
        properties.innerText = remaining_properties_count + "/" + FIREFOX.size;

      });

    </script>
  </body>
</html>
